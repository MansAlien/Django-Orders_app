
<style>
th {
    cursor: pointer;
}
</style>
  

<div class="h-100">
  <div class='row row-cols-1 row-cols-sm-2 row-cols-md-4 g-3'>
    <div class="col mb-3">
      <div class="card bg-dark pb-2" style="border-left: 3px solid #28a745;">
          <div class="card-body text-white fs-5 ">
            <h5 class="card-title text-success m-0">Online</h5>
            <div class='d-flex justify-content-between pt-2'>
              <p class="card-text ps-2"> {{ online }} </p>
              <i class="fs-4 fa-solid fa-signal-bars" style="--fa-primary-color: #ffffff; --fa-secondary-color: #ffffff;"></i>
            </div>
          </div>
      </div>
    </div>
    <div class="col mb-3">
      <div class="card bg-dark pb-2" style="border-left: 3px solid #28a745;">
          <div class="card-body text-white fs-5 ">
            <h5 class="card-title text-success m-0">Activte</h5>
            <div class='d-flex justify-content-between pt-2'>
              <p class="card-text ps-2"> {{ active }} </p>
              <i class="fs-4 fa-solid fa-check" style="color: #ffffff;"></i>
            </div>
          </div>
      </div>
    </div>
    <div class="col mb-3">
      <div class="card bg-dark pb-2" style="border-left: 3px solid #DC4C64;">
          <div class="card-body text-white fs-5 ">
            <h5 class="card-title text-danger m-0">Offline</h5>
            <div class='d-flex justify-content-between pt-2'>
              <p class="card-text ps-2"> {{ offline }} </p>
              <i class="fs-4 fa-solid fa-signal-slash" style="--fa-primary-color: #ffffff; --fa-secondary-color: #ffffff;"></i>
            </div>
          </div>
      </div>
    </div>
    <div class="col mb-3">
      <div class="card bg-dark pb-2" style="border-left: 3px solid #DC4C64;">
          <div class="card-body text-white fs-5 ">
            <h5 class="card-title text-danger m-0">Inactive</h5>
            <div class='d-flex justify-content-between pt-2'>
              <p class="card-text ps-2"> {{ inactive }} </p>
              <i class="fs-4 fa-solid fa-xmark" style="color: #ffffff;"></i>
            </div>
          </div>
      </div>
    </div>
  </div>
  <div class="mt-3 mb-3">
    <button hx-get="{% url 'create_user' %}" hx-target="#dialog" class="btn btn-primary">
      Add Employee
    </button>

    <div id="modal" class="modal fade">
      <div id="dialog" class="modal-dialog" hx-target="this"></div>
    </div>
  </div>


  <div class="row">
    <div class="col">
      <table class="table table-dark table-striped" id="sortable-table">
        <thead>
          <tr>
            <th scope="col" onclick="sortTable(0)" class="sortable">id <span class="sort-arrow"></span></th>
            <th scope="col" onclick="sortTable(1)" class="sortable">username <span class="sort-arrow"></span></th>
            <th scope="col" onclick="sortTable(2)" class="sortable">name <span class="sort-arrow"></span></th>
            <th scope="col" onclick="sortTable(3)" class="sortable">age <span class="sort-arrow"></span></th>
            <th scope="col" onclick="sortTable(4)" class="sortable">gender <span class="sort-arrow"></span></th>
            <th scope="col" onclick="sortTable(5)" class="sortable">jobtitle <span class="sort-arrow"></span></th>
            <th scope="col" onclick="sortTable(6)" class="sortable">salary <span class="sort-arrow"></span></th>
            <th scope="col" onclick="sortTable(7)" class="sortable">O/F <span class="sort-arrow"></span></th>
            <th scope="col">is_active</th>
          </tr>
        </thead>
        <tbody hx-trigger="load, table_refresh from:body" hx-get="{% url 'table_refresh' %}" hx-target="this" >

        </tbody>
      </table>
    </div>
  </div>
  
</div>

<style>
.sortable {
    cursor: pointer;
}

.sort-arrow {
    display: inline-block;
    width: 0;
    height: 0;
    border-style: solid;
    margin-left: 5px;
    border-width: 5px 4px 0 4px;
    border-color: #000 transparent transparent transparent;
}

.sort-arrow.desc {
    border-width: 0 4px 5px 4px;
    border-color: transparent transparent #000 transparent;
}
</style>

<script>
var sortOrders = []; // array to store sort orders for each column

function sortTable(columnIndex) {
    var table, rows, switching, i, x, y, shouldSwitch, sortOrder;
    table = document.getElementById("sortable-table");
    switching = true;
    
    // Initialize sort order for this column
    if (!sortOrders[columnIndex]) {
        sortOrders[columnIndex] = 'asc'; // default: ascending
    } else {
        sortOrders[columnIndex] = (sortOrders[columnIndex] === 'asc') ? 'desc' : 'asc'; // toggle sort order
    }
    sortOrder = sortOrders[columnIndex];
    
    while (switching) {
        switching = false;
        rows = table.rows;
        for (i = 1; i < (rows.length - 1); i++) {
            shouldSwitch = false;
            x = rows[i].getElementsByTagName("td")[columnIndex];
            y = rows[i + 1].getElementsByTagName("td")[columnIndex];
            if (sortOrder === 'asc') {
                if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
                    shouldSwitch = true;
                    break;
                }
            } else {
                if (x.innerHTML.toLowerCase() < y.innerHTML.toLowerCase()) {
                    shouldSwitch = true;
                    break;
                }
            }
        }
        if (shouldSwitch) {
            rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
            switching = true;
        }
    }
    
    // Update sort arrow
    var sortArrows = document.querySelectorAll('.sort-arrow');
    for (var j = 0; j < sortArrows.length; j++) {
        sortArrows[j].classList.remove('desc');
    }
    if (sortOrder === 'desc') {
        sortArrows[columnIndex].classList.add('desc');
    }
}

const modal = new bootstrap.Modal(document.getElementById("modal"))

htmx.on("htmx:afterSwap", (e) => {
  // Response targeting #dialog => show the modal
  if (e.detail.target.id == "dialog") {
    modal.show()
  }
})

htmx.on("htmx:beforeSwap", (e) => {
  // Empty response targeting #dialog => hide the modal
  if (e.detail.target.id == "dialog" && !e.detail.xhr.response) {
    modal.hide()
    e.detail.shouldSwap = false
  }
})

htmx.on("hidden.bs.modal", () => {
  document.getElementById("dialog").innerHTML = ""
})

window.addEventListener('DOMContentLoaded', (event) => {
    // Delay autofocus by 500 milliseconds (adjust the delay as needed)
    setTimeout(() => {
        document.querySelector('#elementToFocus').focus();
    }, 500);
});

</script>

