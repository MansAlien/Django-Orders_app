{% load custom_filters %}
<tr class="dark:bg-gray-900 text-xs">
  <td
    _="on click toggle .hidden on #extend-{% now "G:i:s" %}"
    class="px-2 py-4 text-base dark:hover:text-white cursor-pointer">
    {{ product_line.product }}
  </td>
  <td class="px-2 py-4 text-base">{{ product_line.values }}</td>
  <td class="px-2 py-4 text-base" id="price-{% now "G:i:s" %}">{{ product_line.normal_price }}</td>
  <td class="px-2 py-4 text-base">
    <div class="relative flex items-center">
      <button
        _="on click if (parseInt(#counter-input-{% now "G:i:s" %}.value) > 1)
        then set #counter-input-{% now "G:i:s" %}'s value to (parseInt(#counter-input-{% now "G:i:s" %}.value) - 1) 
        then set #total-price-{% now "G:i:s" %}.innerText to
        ((parseInt(#price-{% now "G:i:s" %}.innerText) * parseInt(#counter-input-{% now "G:i:s" %}.value)).toFixed(2))
        then call calculateTotal()"
        type="button"
        class="flex-shrink-0 bg-gray-100 dark:bg-gray-700 dark:hover:bg-gray-600 dark:border-gray-600
        hover:bg-gray-200 inline-flex items-center justify-center border border-gray-300 rounded-md
        h-5 w-5 focus:ring-gray-100 dark:focus:ring-gray-700 focus:ring-2 focus:outline-none">
        <i class="fa-solid fa-minus"></i>
      </button>
      <input
      type="text" id="counter-input-{% now "G:i:s" %}" 
      class="flex-shrink-0 text-gray-900 dark:text-white border-0 bg-transparent
      text-sm font-normal focus:outline-none focus:ring-0 w-[2rem] text-center"
      value="1"
      _="on change set #total-price-{% now "G:i:s" %}.innerText to
      ((parseInt(#price-{% now "G:i:s" %}.innerText) * parseInt(#counter-input-{% now "G:i:s" %}.value)).toFixed(2))
      then call calculateTotal()"/>
      <button
        _="on click set #counter-input-{% now "G:i:s" %}'s value to
        (parseInt(#counter-input-{% now "G:i:s" %}.value) + 1)
        then set #total-price-{% now "G:i:s" %}.innerText to
        ((parseInt(#price-{% now "G:i:s" %}.innerText) * parseInt(#counter-input-{% now "G:i:s" %}.value)).toFixed(2))
        then call calculateTotal()"
        type="button" id="decrement-button" 
        class="flex-shrink-0 bg-gray-100 dark:bg-gray-700 dark:hover:bg-gray-600 dark:border-gray-600
        hover:bg-gray-200 inline-flex items-center justify-center border border-gray-300 rounded-md
        h-5 w-5 focus:ring-gray-100 dark:focus:ring-gray-700 focus:ring-2 focus:outline-none">
        <i class="fa-solid fa-plus"></i>
      </button>
    </div>
  </td> <!--amount-->
  <td class="px-2 py-4 text-base" id="total-price-{% now "G:i:s" %}">{{ product_line.normal_price }}</td>
  <td class="px-2 py-4 text-base">
    <select id="delivery-type-{% now "G:i:s" %}"
      _="on change if my.value == 'F' then 
      set #price-{% now "G:i:s" %}.innerText to {{ product_line.fawry_price }} 
      then set #total-price-{% now "G:i:s" %}.innerText to 
      ({{ product_line.fawry_price }} * parseInt(#counter-input-{% now "G:i:s" %}.value)).toFixed(2) 
      then call calculateTotal()
      else 
      set #price-{% now "G:i:s" %}.innerText to {{ product_line.normal_price }} 
      then set #total-price-{% now "G:i:s" %}.innerText to 
      ({{ product_line.normal_price }} * parseInt(#counter-input-{% now "G:i:s" %}.value)).toFixed(2)
      then call calculateTotal()"
      class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-blue-500
      focus:border-blue-500 block p-1 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400
      dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
      <option value="N" selected>normal</option>
      <option value="F">fawry</option>
    </select>
  </td>
  <td class="px-2 py-4 text-base">
    <select 
      class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-full focus:ring-blue-500
      focus:border-blue-500 block p-1 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400
      dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
      <option value="P" selected>Printing</option>
      <option value="D">Delivered</option>
    </select>
  </td>
  <td class="px-3 py-4 text-base">
    <div class="flex gap-5">
      <a 
        hx-get="{% url 'edit_order_detail' %}"
        hx-target="#modal_form"
        hx-swap="innerHtml"
        _="on click remove .hidden from modal_div"
        class="cursor-pointer hover:text-blue-700">
        <i class="fa-solid fa-pen-to-square"></i>
      </a>
      <a 
        _="on click if confirm('Are you sure you want to delete this row?') then remove closest <tr/>
        then call calculateTotal()"
        class="cursor-pointer hover:text-red-700">
        <i class="fa-solid fa-trash"></i>
      </a>
    </div>
  </td>
</tr>
<tr id="extend-{% now "G:i:s" %}" class="hidden dark:bg-gray-800 text-xs">
  <td colspan="8" class=" text-base">
    <table class="w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-200">
      <tbody>
        <tr class="border-b border-gray-200 dark:border-gray-600">
          <th scope="row" class="uppercase px-6 py-2 font-medium text-gray-900 whitespace-nowrap bg-gray-50 dark:text-white dark:bg-gray-700"> comment </th>
          <td class="px-6 py-2"> </td>
        </tr>
        <tr class="border-b border-gray-200 dark:border-gray-600">
          <th scope="row" class="uppercase px-6 py-2 font-medium text-gray-900 whitespace-nowrap bg-gray-50 dark:text-white dark:bg-gray-700"> Date </th>
          <td class="px-2 py-2 text-base"> {% now "M d, Y g:i a" %} </td>
        </tr>
        <tr class="border-b border-gray-200 dark:border-gray-600">
          <th scope="row" class="uppercase px-6 py-2 font-medium text-gray-900 whitespace-nowrap bg-gray-50 dark:text-white dark:bg-gray-700"> Deliver Date </th>
          <td class="px-2 py-2 text-base">
            {% now "Y-m-d H:i:s" as current_datetime %}
            {% with current_datetime|add_days:product_line.deliver_date as new_datetime %}
            {{ new_datetime|date:"M d, Y g:i a" }}
            {% endwith %}
          </td>
        </tr>
        <tr class="border-b border-gray-200 dark:border-gray-600">
          <th scope="row" class="uppercase px-6 py-2 font-medium text-gray-900 whitespace-nowrap bg-gray-50 dark:text-white dark:bg-gray-700"> location </th>
          <td class="px-6 py-2"> {{ user.user.email }} </td>
        </tr>
      </tbody>
    </table>
  </td>
</tr>
